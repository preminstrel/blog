<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  
  <meta name="author" content="Hanshi Sun">

  
  
  <meta name="description" content="MMDetection æ˜¯ä¸€ä¸ªåŸºäº PyTorch çš„ç›®æ ‡æ£€æµ‹å¼€æºå·¥å…·ç®±ã€‚å®ƒæ˜¯ OpenMMLab é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚ç›®å‰å·²ç»å¤ç°äº†å¤§éƒ¨åˆ†ä¸»æµå’Œå‰æ²¿æ¨¡å‹ï¼Œä¾‹å¦‚ Faster R-CNN ç³»åˆ—ã€Mask R-CNN ç³»åˆ—ã€YOLO ç³»åˆ—å’Œæ¯”è¾ƒ">
  

  
  <link rel="icon" href="https://preminstrel.github.io/blog/favicon.ico">

  
  
  <meta name="keywords" content=" hugo  latex  theme ">
  

  
  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css"
  integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
  integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js"
  integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '\\[', right: '\\]', display: true },
        { left: '$', right: '$', display: false },
        { left: '\\(', right: '\\)', display: false }
      ],
      ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option'],
      throwOnError: false
    });
  });
</script>


  

  
  <meta property="og:title" content="MMDetection Overview" />
<meta property="og:description" content="MMDetection æ˜¯ä¸€ä¸ªåŸºäº PyTorch çš„ç›®æ ‡æ£€æµ‹å¼€æºå·¥å…·ç®±ã€‚å®ƒæ˜¯ OpenMMLab é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚ç›®å‰å·²ç»å¤ç°äº†å¤§éƒ¨åˆ†ä¸»æµå’Œå‰æ²¿æ¨¡å‹ï¼Œä¾‹å¦‚ Faster R-CNN ç³»åˆ—ã€Mask R-CNN ç³»åˆ—ã€YOLO ç³»åˆ—å’Œæ¯”è¾ƒ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://preminstrel.github.io/blog/post/2022/01/15/mmdetection-overview/" />
<meta property="article:published_time" content="2022-01-15T12:12:07+08:00" />
<meta property="article:modified_time" content="2022-01-15T00:00:00+00:00" />


  
  <link rel="canonical" href="https://preminstrel.github.io/blog/post/2022/01/15/mmdetection-overview/">

  
  
  <meta itemprop="name" content="MMDetection Overview">
<meta itemprop="description" content="MMDetection æ˜¯ä¸€ä¸ªåŸºäº PyTorch çš„ç›®æ ‡æ£€æµ‹å¼€æºå·¥å…·ç®±ã€‚å®ƒæ˜¯ OpenMMLab é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚ç›®å‰å·²ç»å¤ç°äº†å¤§éƒ¨åˆ†ä¸»æµå’Œå‰æ²¿æ¨¡å‹ï¼Œä¾‹å¦‚ Faster R-CNN ç³»åˆ—ã€Mask R-CNN ç³»åˆ—ã€YOLO ç³»åˆ—å’Œæ¯”è¾ƒ">
<meta itemprop="datePublished" content="2022-01-15T12:12:07&#43;08:00" />
<meta itemprop="dateModified" content="2022-01-15T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="3791">



<meta itemprop="keywords" content="Object Detection,Deep Learning,MMDetection," />

  
  <link media="screen" rel="stylesheet" href='https://preminstrel.github.io/blog/css/common.css'>
  <link media="screen" rel="stylesheet" href='https://preminstrel.github.io/blog/css/content.css'>

  
  
  <title>MMDetection Overview - Blog de Preminstrel</title>
  

  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MMDetection Overview"/>
<meta name="twitter:description" content="MMDetection æ˜¯ä¸€ä¸ªåŸºäº PyTorch çš„ç›®æ ‡æ£€æµ‹å¼€æºå·¥å…·ç®±ã€‚å®ƒæ˜¯ OpenMMLab é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚ç›®å‰å·²ç»å¤ç°äº†å¤§éƒ¨åˆ†ä¸»æµå’Œå‰æ²¿æ¨¡å‹ï¼Œä¾‹å¦‚ Faster R-CNN ç³»åˆ—ã€Mask R-CNN ç³»åˆ—ã€YOLO ç³»åˆ—å’Œæ¯”è¾ƒ"/>


  
<link rel="stylesheet" href='https://preminstrel.github.io/blog/css/single.css'>

</head>

<body>
  <div id="wrapper">
    <header id="header">
  <h1>
    <a href="https://preminstrel.github.io/blog/">Blog de Preminstrel</a>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      <a class="link" href="/blog/">Post</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/blog/post/">Archives</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/blog/about/">About</a>
    </span>
    
  </nav>
</header>

    
<main id="main" class="post">
  
  
  <h1>MMDetection Overview</h1>
  
  <div>
    <b>Keywords: </b>
    
    <a class="link" href='https://preminstrel.github.io/blog/tags/object-detection'>#Object Detection</a>
    
    <a class="link" href='https://preminstrel.github.io/blog/tags/deep-learning'>#Deep Learning</a>
    
    <a class="link" href='https://preminstrel.github.io/blog/tags/mmdetection'>#MMDetection</a>
    
  </div>
  
  
  <article class="content">
    
    <p><a href="https://github.com/open-mmlab/mmdetection">MMDetection</a> æ˜¯ä¸€ä¸ªåŸºäº PyTorch çš„ç›®æ ‡æ£€æµ‹å¼€æºå·¥å…·ç®±ã€‚å®ƒæ˜¯ <a href="https://openmmlab.com/">OpenMMLab</a> é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚ç›®å‰å·²ç»å¤ç°äº†å¤§éƒ¨åˆ†ä¸»æµå’Œå‰æ²¿æ¨¡å‹ï¼Œä¾‹å¦‚ Faster R-CNN ç³»åˆ—ã€Mask R-CNN ç³»åˆ—ã€YOLO ç³»åˆ—å’Œæ¯”è¾ƒæ–°çš„ DETR ç­‰ç­‰ï¼Œæ¨¡å‹åº“éå¸¸ä¸°å¯Œï¼Œåœ¨å­¦æœ¯ç ”ç©¶å’Œå·¥ä¸šè½åœ°ä¸­åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p>
<div align=center>
<img src="/img/20220115131101.png" width="800px"/>
</div>
<h1 id="classifications">Classifications</h1>
<p>æŒ‰ç…§ç›®å‰ç›®æ ‡æ£€æµ‹çš„å‘å±•ï¼Œå¯ä»¥å¤§æ¦‚å½’çº³ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="mermaid">
graph LR
	id1(Object Detection)---id2(satge);
	id1---id3(anchor);
	id1---id4(transformer)-.-id9(DETR, Deformable DETR, ...)
	id2---id5(two-stage)-.-id11(Faster R-CNN, Cascade R-CNN, Libra R-CNN, ...)
	id5(two-stage)-.-id12(TridentNet,...)
	id2---id6(one-stage)-.-id13(RetinaNet, YOLO, FCOS, PrePoints, ...)
	id3---id7(anchor-based)-.-id14(Faster R-CNN, YOLO, ...)
	id3---id8(anchor-free)-.-id15(FCOS, ...)
</div>
<p>æ³¨æ„ä¸Šé¢ä»…ä»…å†™äº†å‡ ä¸ªå…¸å‹ç®—æ³•è€Œå·²ï¼Œç®€å•æ¥è¯´ç›®æ ‡æ£€æµ‹ç®—æ³•å¯ä»¥æŒ‰ç…§ 3 ä¸ªç»´åº¦åˆ’åˆ†ï¼š</p>
<ul>
<li><strong>æŒ‰ç…§ stage ä¸ªæ•°åˆ’åˆ†</strong>ï¼Œå¸¸è§„æ˜¯ one-stage å’Œ two-stageï¼Œä½†æ˜¯å®é™…ä¸Šç•Œé™ä¸æ˜¯ç‰¹åˆ«æ¸…æ™°ï¼Œä¾‹å¦‚å¸¦ refine é˜¶æ®µçš„ç®—æ³• RepPointsï¼Œå®é™…ä¸Šå¯ä»¥è®¤ä¸ºæ˜¯1.5 stage ç®—æ³•ï¼Œè€Œ Cascade R-CNN å¯ä»¥è®¤ä¸ºæ˜¯å¤šé˜¶æ®µç®—æ³•ï¼Œä¸ºäº†ç®€å•ï¼Œä¸Šé¢å›¾ç¤ºæ²¡æœ‰åˆ’åˆ†å¦‚æ­¤ç»†è‡´</li>
<li><strong>æŒ‰ç…§æ˜¯å¦éœ€è¦é¢„å®šä¹‰ anchor åˆ’åˆ†</strong>ï¼Œå¸¸è§„æ˜¯ anchor-based å’Œ anchor-freeï¼Œå½“ç„¶ä¹Ÿæœ‰äº›ç®—æ³•æ˜¯ä¸¤è€…æ··åˆçš„</li>
<li><strong>æŒ‰ç…§æ˜¯å¦é‡‡ç”¨äº† transformer ç»“æ„åˆ’åˆ†</strong>ï¼Œç›®å‰åŸºäº transformer ç»“æ„çš„ç›®æ ‡æ£€æµ‹ç®—æ³•å‘å±•è¿…é€Ÿï¼Œä¹Ÿå¼•èµ·äº†æå¤§çš„å…³æ³¨ï¼Œæ‰€ä»¥è¿™é‡Œç‰¹æ„å¢åŠ äº†è¿™ä¸ªç±»åˆ«çš„åˆ’åˆ†</li>
</ul>
<p>ä¸ç®¡å“ªç§åˆ’åˆ†æ–¹å¼ï¼Œå…¶å®éƒ½å¯ä»¥åˆ†æˆè‹¥å¹²å›ºå®šæ¨¡å—ï¼Œç„¶åé€šè¿‡æ¨¡å—å †å æ¥æ„å»ºæ•´ä¸ªæ£€æµ‹ç®—æ³•ä½“ç³»ã€‚</p>
<h1 id="pipeline">Pipeline</h1>
<p>ç°åœ¨è¿™ä¸ªæ¡†æ¶å°†æ£€æµ‹æ‹†è§£æ¨¡å—åŒ–ä¸º <em><strong>backbone</strong></em>ï¼Œ<em><strong>neck</strong></em>ï¼Œ<em><strong>head</strong></em>ï¼Œæ— è®ºæ˜¯å•é˜¶æ®µè¿˜æ˜¯åŒé˜¶æ®µã€‚çº¿ç´¢æ¸…æ™°ï¼Œä½“ç³»è‡ªæˆã€‚åŸºäºç›®å‰ä»£ç å®ç°ï¼Œæ‰€æœ‰ç›®æ ‡æ£€æµ‹ç®—æ³•éƒ½æŒ‰ç…§ä»¥ä¸‹æµç¨‹è¿›è¡Œåˆ’åˆ†ï¼š</p>
<div align=center>
<img src="/img/20220115135201.jpg" width="600px"/>
</div>
<h2 id="train">Train</h2>
<p>è®­ç»ƒéƒ¨åˆ†ä¸€èˆ¬åŒ…æ‹¬ 9 ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œæ€»ä½“æµç¨‹æ˜¯ï¼š</p>
<ol>
<li>ä»»ä½•ä¸€ä¸ª batch çš„å›¾ç‰‡å…ˆè¾“å…¥åˆ° backbone ä¸­è¿›è¡Œç‰¹å¾æå–ï¼Œå…¸å‹çš„éª¨å¹²ç½‘ç»œæ˜¯ <em><strong>ResNet</strong></em></li>
<li>è¾“å‡ºçš„å•å°ºåº¦æˆ–è€…å¤šå°ºåº¦ç‰¹å¾å›¾è¾“å…¥åˆ° neck æ¨¡å—ä¸­è¿›è¡Œç‰¹å¾èåˆæˆ–è€…å¢å¼ºï¼Œå…¸å‹çš„ neck æ˜¯ <em><strong>FPN</strong></em></li>
<li>ä¸Šè¿°å¤šå°ºåº¦ç‰¹å¾æœ€ç»ˆè¾“å…¥åˆ° head éƒ¨åˆ†ï¼Œä¸€èˆ¬éƒ½ä¼šåŒ…æ‹¬åˆ†ç±»å’Œå›å½’åˆ†æ”¯è¾“å‡º</li>
<li>åœ¨æ•´ä¸ªç½‘ç»œæ„å»ºé˜¶æ®µéƒ½å¯ä»¥å¼•å…¥ä¸€äº›å³æ’å³ç”¨å¢å¼ºç®—å­æ¥å¢åŠ æå–æå–èƒ½åŠ›ï¼Œå…¸å‹çš„ä¾‹å¦‚ SPPã€DCN ç­‰ç­‰</li>
<li>ç›®æ ‡æ£€æµ‹ head è¾“å‡ºä¸€èˆ¬æ˜¯ç‰¹å¾å›¾ï¼Œå¯¹äºåˆ†ç±»ä»»åŠ¡å­˜åœ¨ä¸¥é‡çš„æ­£è´Ÿæ ·æœ¬ä¸å¹³è¡¡ï¼Œå¯ä»¥é€šè¿‡æ­£è´Ÿæ ·æœ¬å±æ€§åˆ†é…å’Œé‡‡æ ·æ§åˆ¶</li>
<li>ä¸ºäº†æ–¹ä¾¿æ”¶æ•›å’Œå¹³è¡¡å¤šåˆ†æ”¯ï¼Œä¸€èˆ¬éƒ½ä¼šå¯¹ gt bbox è¿›è¡Œç¼–ç </li>
<li>æœ€åä¸€æ­¥æ˜¯è®¡ç®—åˆ†ç±»å’Œå›å½’ lossï¼Œè¿›è¡Œè®­ç»ƒ</li>
<li>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¹ŸåŒ…æ‹¬éå¸¸å¤šçš„ trickï¼Œä¾‹å¦‚ä¼˜åŒ–å™¨é€‰æ‹©ç­‰ï¼Œå‚æ•°è°ƒèŠ‚ä¹Ÿéå¸¸å…³é”®</li>
</ol>
<p>æ³¨æ„ä¸Šè¿° 9 ä¸ªç»„ä»¶ä¸æ˜¯æ¯ä¸ªç®—æ³•éƒ½éœ€è¦çš„ï¼Œä¸‹é¢è¯¦ç»†åˆ†æã€‚</p>
<h3 id="backbone">Backbone</h3>
<div class="mermaid">
graph LR
	id1(ResNet)---id2(ResNext)---id3(Res2Net)---id4(ResNeSt)---id5(DarkNet)---id7(SSD_VGG);
</div>
<p>backbone ä½œç”¨ä¸»è¦æ˜¯<strong class=chinese>ç‰¹å¾æå–</strong>ã€‚ç›®å‰ MMDetection ä¸­å·²ç»é›†æˆäº†å¤§éƒ¨åˆ†éª¨æ¶ç½‘ç»œï¼Œå…·ä½“è§æ–‡ä»¶ï¼š<code>mmdet/models/backbones</code>ï¼Œå·²ç»å®ç°çš„éª¨æ¶æœ‰ï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">__all__ <span style="color:#666">=</span> [
    <span style="color:#b44">&#39;RegNet&#39;</span>, <span style="color:#b44">&#39;ResNet&#39;</span>, <span style="color:#b44">&#39;ResNetV1d&#39;</span>, <span style="color:#b44">&#39;ResNeXt&#39;</span>, <span style="color:#b44">&#39;SSDVGG&#39;</span>, <span style="color:#b44">&#39;HRNet&#39;</span>, <span style="color:#b44">&#39;Res2Net&#39;</span>,
    <span style="color:#b44">&#39;HourglassNet&#39;</span>, <span style="color:#b44">&#39;DetectoRS_ResNet&#39;</span>, <span style="color:#b44">&#39;DetectoRS_ResNeXt&#39;</span>, <span style="color:#b44">&#39;Darknet&#39;</span>,
    <span style="color:#b44">&#39;ResNeSt&#39;</span>, <span style="color:#b44">&#39;TridentResNet&#39;</span>
]
</code></pre></div><p>æœ€å¸¸ç”¨çš„æ˜¯ ResNet ç³»åˆ—ã€ResNetV1d ç³»åˆ—å’Œ Res2Net ç³»åˆ—ã€‚å¦‚æœéœ€è¦å¯¹éª¨æ¶è¿›è¡Œæ‰©å±•ï¼Œå¯ä»¥ç»§æ‰¿ä¸Šè¿°ç½‘ç»œï¼Œç„¶åé€šè¿‡<strong class=chinese>æ³¨å†Œå™¨æœºåˆ¶æ³¨å†Œä½¿ç”¨</strong>ã€‚ä¸€ä¸ªå…¸å‹ç”¨æ³•ä¸ºï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-style:italic"># éª¨æ¶çš„é¢„è®­ç»ƒæƒé‡è·¯å¾„</span>
pretrained<span style="color:#666">=</span><span style="color:#b44">&#39;torchvision://resnet50&#39;</span>,
backbone<span style="color:#666">=</span><span style="color:#a2f">dict</span>(
    <span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;ResNet&#39;</span>, <span style="color:#080;font-style:italic"># éª¨æ¶ç±»åï¼Œåé¢çš„å‚æ•°éƒ½æ˜¯è¯¥ç±»çš„åˆå§‹åŒ–å‚æ•°</span>
    depth<span style="color:#666">=</span><span style="color:#666">50</span>,
    num_stages<span style="color:#666">=</span><span style="color:#666">4</span>,
    out_indices<span style="color:#666">=</span>(<span style="color:#666">0</span>, <span style="color:#666">1</span>, <span style="color:#666">2</span>, <span style="color:#666">3</span>),
    frozen_stages<span style="color:#666">=</span><span style="color:#666">1</span>,
    norm_cfg<span style="color:#666">=</span><span style="color:#a2f">dict</span>(<span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;BN&#39;</span>, requires_grad<span style="color:#666">=</span>True), 
    norm_eval<span style="color:#666">=</span>True,
    style<span style="color:#666">=</span><span style="color:#b44">&#39;pytorch&#39;</span>),
</code></pre></div><p>é€šè¿‡ MMCV ä¸­çš„æ³¨å†Œå™¨æœºåˆ¶ï¼Œ<strong>å¯ä»¥é€šè¿‡ dict å½¢å¼çš„é…ç½®æ¥å®ä¾‹åŒ–ä»»ä½•å·²ç»æ³¨å†Œçš„ç±»</strong>ï¼Œéå¸¸æ–¹ä¾¿å’Œçµæ´»ã€‚</p>
<h3 id="neck">Neck</h3>
<div class="mermaid">
graph LR
	id1(FPN)---id2(BFP)---id3(RFP)---id4(PAFPN)---id5(NAS_FPN)---id7(HRFPN);
</div>
<p>neck å¯ä»¥è®¤ä¸ºæ˜¯ backbone å’Œ head çš„<strong class=chinese>è¿æ¥å±‚</strong>ï¼Œä¸»è¦è´Ÿè´£<strong>å¯¹ backbone çš„ç‰¹å¾è¿›è¡Œé«˜æ•ˆèåˆå’Œå¢å¼ºï¼Œèƒ½å¤Ÿå¯¹è¾“å…¥çš„å•å°ºåº¦æˆ–è€…å¤šå°ºåº¦ç‰¹å¾è¿›è¡Œèåˆã€å¢å¼ºè¾“å‡ºç­‰</strong>ã€‚å…·ä½“è§æ–‡ä»¶ï¼š<code>mmdet/models/necks</code>ï¼Œå·²ç»å®ç°çš„ neck å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">__all__ <span style="color:#666">=</span> [
    <span style="color:#b44">&#39;FPN&#39;</span>, <span style="color:#b44">&#39;BFP&#39;</span>, <span style="color:#b44">&#39;ChannelMapper&#39;</span>, <span style="color:#b44">&#39;HRFPN&#39;</span>, <span style="color:#b44">&#39;NASFPN&#39;</span>, <span style="color:#b44">&#39;FPN_CARAFE&#39;</span>, <span style="color:#b44">&#39;PAFPN&#39;</span>,
    <span style="color:#b44">&#39;NASFCOS_FPN&#39;</span>, <span style="color:#b44">&#39;RFP&#39;</span>, <span style="color:#b44">&#39;YOLOV3Neck&#39;</span>
]
</code></pre></div><p>æœ€å¸¸ç”¨çš„åº”è¯¥æ˜¯ <em><strong>FPN</strong></em>ï¼Œä¸€ä¸ªå…¸å‹ç”¨æ³•æ˜¯ï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">neck<span style="color:#666">=</span><span style="color:#a2f">dict</span>(
    <span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;FPN&#39;</span>,
    in_channels<span style="color:#666">=</span>[<span style="color:#666">256</span>, <span style="color:#666">512</span>, <span style="color:#666">1024</span>, <span style="color:#666">2048</span>], <span style="color:#080;font-style:italic"># éª¨æ¶å¤šå°ºåº¦ç‰¹å¾å›¾è¾“å‡ºé€šé“</span>
    out_channels<span style="color:#666">=</span><span style="color:#666">256</span>, <span style="color:#080;font-style:italic"># å¢å¼ºåé€šé“è¾“å‡º</span>
    num_outs<span style="color:#666">=</span><span style="color:#666">5</span>), <span style="color:#080;font-style:italic"># è¾“å‡ºnum_outsä¸ªå¤šå°ºåº¦ç‰¹å¾å›¾</span>
</code></pre></div><h3 id="head">Head</h3>
<div class="mermaid">
graph LR
	id1(FC Mode)---id2(Conv Mode);
</div>
<p>ç›®æ ‡æ£€æµ‹ç®—æ³•è¾“å‡ºä¸€èˆ¬åŒ…æ‹¬<strong class=chinese>åˆ†ç±»å’Œæ¡†åæ ‡å›å½’</strong>ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸åŒç®—æ³• head æ¨¡å—å¤æ‚ç¨‹åº¦ä¸ä¸€æ ·ï¼Œçµæ´»åº¦æ¯”è¾ƒé«˜ã€‚åœ¨ç½‘ç»œæ„å»ºæ–¹é¢ï¼Œç†è§£ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸»è¦æ˜¯è¦ç†è§£ head æ¨¡å—ã€‚</p>
<p>MMDetection ä¸­ head æ¨¡å—åˆåˆ’åˆ†ä¸º <strong>two-stage æ‰€éœ€çš„ RoIHead å’Œ one-stage æ‰€éœ€çš„ DenseHead</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„ one-stage ç®—æ³•çš„ head æ¨¡å—éƒ½åœ¨<code>mmdet/models/dense_heads</code>ä¸­ï¼Œè€Œ two-stage ç®—æ³•è¿˜åŒ…æ‹¬é¢å¤–çš„<code>mmdet/models/roi_heads</code>ã€‚</p>
<p>ç›®å‰ä¸­å·²ç»å®ç°çš„ dense_heads åŒ…æ‹¬ï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">__all__ <span style="color:#666">=</span> [
    <span style="color:#b44">&#39;AnchorFreeHead&#39;</span>, <span style="color:#b44">&#39;AnchorHead&#39;</span>, <span style="color:#b44">&#39;GuidedAnchorHead&#39;</span>, <span style="color:#b44">&#39;FeatureAdaption&#39;</span>,
    <span style="color:#b44">&#39;RPNHead&#39;</span>, <span style="color:#b44">&#39;GARPNHead&#39;</span>, <span style="color:#b44">&#39;RetinaHead&#39;</span>, <span style="color:#b44">&#39;RetinaSepBNHead&#39;</span>, <span style="color:#b44">&#39;GARetinaHead&#39;</span>,
    <span style="color:#b44">&#39;SSDHead&#39;</span>, <span style="color:#b44">&#39;FCOSHead&#39;</span>, <span style="color:#b44">&#39;RepPointsHead&#39;</span>, <span style="color:#b44">&#39;FoveaHead&#39;</span>,
    <span style="color:#b44">&#39;FreeAnchorRetinaHead&#39;</span>, <span style="color:#b44">&#39;ATSSHead&#39;</span>, <span style="color:#b44">&#39;FSAFHead&#39;</span>, <span style="color:#b44">&#39;NASFCOSHead&#39;</span>,
    <span style="color:#b44">&#39;PISARetinaHead&#39;</span>, <span style="color:#b44">&#39;PISASSDHead&#39;</span>, <span style="color:#b44">&#39;GFLHead&#39;</span>, <span style="color:#b44">&#39;CornerHead&#39;</span>, <span style="color:#b44">&#39;YOLACTHead&#39;</span>,
    <span style="color:#b44">&#39;YOLACTSegmHead&#39;</span>, <span style="color:#b44">&#39;YOLACTProtonet&#39;</span>, <span style="color:#b44">&#39;YOLOV3Head&#39;</span>, <span style="color:#b44">&#39;PAAHead&#39;</span>,
    <span style="color:#b44">&#39;SABLRetinaHead&#39;</span>, <span style="color:#b44">&#39;CentripetalHead&#39;</span>, <span style="color:#b44">&#39;VFNetHead&#39;</span>, <span style="color:#b44">&#39;TransformerHead&#39;</span>
]
</code></pre></div><p>å‡ ä¹æ¯ä¸ªç®—æ³•éƒ½åŒ…æ‹¬ä¸€ä¸ªç‹¬ç«‹çš„ headï¼Œè€Œ roi_heads æ¯”è¾ƒæ‚ï¼Œå°±ä¸åˆ—å‡ºäº†ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>two-stage æˆ–è€… mutli-stage ç®—æ³•ï¼Œä¼šé¢å¤–åŒ…æ‹¬ä¸€ä¸ªåŒºåŸŸæå–å™¨ roi extractorï¼Œç”¨äºå°†ä¸åŒå¤§å°çš„ RoI ç‰¹å¾å›¾ç»Ÿä¸€æˆç›¸åŒå¤§å°</strong>ã€‚</p>
<p>è™½ç„¶ head éƒ¨åˆ†çš„ç½‘ç»œæ„å»ºæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ç”±äºæ­£è´Ÿæ ·æœ¬å±æ€§å®šä¹‰ã€æ­£è´Ÿæ ·æœ¬é‡‡æ ·å’Œ bbox ç¼–è§£ç æ¨¡å—éƒ½åœ¨ head æ¨¡å—ä¸­è¿›è¡Œç»„åˆè°ƒç”¨ï¼Œæ•… MMDetection <strong>ä¸­æœ€å¤æ‚çš„æ¨¡å—å°±æ˜¯ head</strong>ã€‚åœ¨æœ€åçš„æ•´ä½“æµç¨‹éƒ¨åˆ†ä¼šå¯¹è¯¥æ¨¡å—è¿›è¡Œè¯¦ç»†åˆ†æã€‚</p>
<h3 id="enhance">Enhance</h3>
<div class="mermaid">
graph LR
	id1(SPP)---id2(ASP)---id3(Attention);
</div>
<p>enhance æ˜¯<strong>å³æ’å³ç”¨ã€èƒ½å¤Ÿå¯¹ç‰¹å¾è¿›è¡Œå¢å¼ºçš„æ¨¡å—</strong>ï¼Œå…¶å…·ä½“ä»£ç å¯ä»¥é€šè¿‡ dict å½¢å¼æ³¨å†Œåˆ° backboneã€neck å’Œ head ä¸­ï¼Œéå¸¸æ–¹ä¾¿ã€‚å¸¸ç”¨çš„ enhance æ¨¡å—æ˜¯ SPPã€ASPPã€RFBã€Dropoutã€Dropblockã€DCN å’Œå„ç§æ³¨æ„åŠ›æ¨¡å— SeNetã€Non_Localã€CBA ç­‰ã€‚ç›®å‰ MMDetection ä¸­éƒ¨åˆ†æ¨¡å—æ”¯æŒ enhance çš„æ¥å…¥ï¼Œä¾‹å¦‚ ResNet éª¨æ¶ä¸­çš„ pluginsã€‚</p>
<h3 id="bbox-assigner">BBox Assigner</h3>
<p>æ­£è´Ÿæ ·æœ¬å±æ€§åˆ†é…æ¨¡å—ä½œç”¨æ˜¯è¿›è¡Œæ­£è´Ÿæ ·æœ¬å®šä¹‰æˆ–è€…æ­£è´Ÿæ ·æœ¬åˆ†é…ï¼ˆå¯èƒ½ä¹ŸåŒ…æ‹¬å¿½ç•¥æ ·æœ¬å®šä¹‰ï¼‰ï¼Œæ­£æ ·æœ¬å°±æ˜¯å¸¸è¯´çš„å‰æ™¯æ ·æœ¬ï¼ˆå¯ä»¥æ˜¯ä»»ä½•ç±»åˆ«ï¼‰ï¼Œè´Ÿæ ·æœ¬å°±æ˜¯èƒŒæ™¯æ ·æœ¬ã€‚å› ä¸ºç›®æ ‡æ£€æµ‹æ˜¯ä¸€ä¸ªåŒæ—¶è¿›è¡Œåˆ†ç±»å’Œå›å½’çš„é—®é¢˜ï¼Œå¯¹äºåˆ†ç±»åœºæ™¯å¿…ç„¶éœ€è¦ç¡®å®šæ­£è´Ÿæ ·æœ¬ï¼Œå¦åˆ™æ— æ³•è®­ç»ƒã€‚<strong>è¯¥æ¨¡å—è‡³å…³é‡è¦ï¼Œä¸åŒçš„æ­£è´Ÿæ ·æœ¬åˆ†é…ç­–ç•¥ä¼šå¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½å·®å¼‚</strong>ï¼Œç›®å‰å¤§éƒ¨åˆ†ç›®æ ‡æ£€æµ‹ç®—æ³•éƒ½ä¼šå¯¹è¿™ä¸ªéƒ¨åˆ†è¿›è¡Œæ”¹è¿›ï¼Œè‡³å…³é‡è¦ã€‚</p>
<p>å¯¹åº”çš„ä»£ç åœ¨<code>mmdet/core/bbox/assigners</code>ä¸­ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">__all__ <span style="color:#666">=</span> [
    <span style="color:#b44">&#39;BaseAssigner&#39;</span>, <span style="color:#b44">&#39;MaxIoUAssigner&#39;</span>, <span style="color:#b44">&#39;ApproxMaxIoUAssigner&#39;</span>, 
    <span style="color:#b44">&#39;PointAssigner&#39;</span>, <span style="color:#b44">&#39;ATSSAssigner&#39;</span>, <span style="color:#b44">&#39;CenterRegionAssigner&#39;</span>, <span style="color:#b44">&#39;GridAssigner&#39;</span>,
    <span style="color:#b44">&#39;HungarianAssigner&#39;</span>
]
</code></pre></div><h3 id="bbox-sampler">BBox Sampler</h3>
<p>åœ¨ç¡®å®šæ¯ä¸ªæ ·æœ¬çš„æ­£è´Ÿå±æ€§åï¼Œå¯èƒ½è¿˜éœ€è¦è¿›è¡Œ<strong class=chinese>æ ·æœ¬å¹³è¡¡æ“ä½œ</strong>ã€‚æœ¬æ¨¡å—ä½œç”¨æ˜¯<strong>å¯¹å‰é¢å®šä¹‰çš„æ­£è´Ÿæ ·æœ¬ä¸å¹³è¡¡è¿›è¡Œé‡‡æ ·ï¼ŒåŠ›äº‰å…‹æœè¯¥é—®é¢˜</strong>ã€‚ä¸€èˆ¬åœ¨ç›®æ ‡æ£€æµ‹ä¸­ gt bbox éƒ½æ˜¯éå¸¸å°‘çš„ï¼Œæ‰€ä»¥æ­£è´Ÿæ ·æœ¬æ¯”æ˜¯è¿œè¿œå°äº 1 çš„ã€‚è€ŒåŸºäºæœºå™¨å­¦ä¹ è§‚ç‚¹ï¼šåœ¨æ•°æ®æåº¦ä¸å¹³è¡¡æƒ…å†µä¸‹è¿›è¡Œåˆ†ç±»ä¼šå‡ºç°é¢„æµ‹å€¾å‘äºæ ·æœ¬å¤šçš„ç±»åˆ«ï¼Œå‡ºç°è¿‡æ‹Ÿåˆï¼Œä¸ºäº†å…‹æœè¯¥é—®é¢˜ï¼Œé€‚å½“çš„æ­£è´Ÿæ ·æœ¬é‡‡æ ·ç­–ç•¥æ˜¯éå¸¸å¿…è¦çš„ã€‚</p>
<p>å¯¹åº”çš„ä»£ç åœ¨<code>mmdet/core/bbox/samplers</code>ä¸­ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">__all__ <span style="color:#666">=</span> [
    <span style="color:#b44">&#39;BaseSampler&#39;</span>, <span style="color:#b44">&#39;PseudoSampler&#39;</span>, <span style="color:#b44">&#39;RandomSampler&#39;</span>,
    <span style="color:#b44">&#39;InstanceBalancedPosSampler&#39;</span>, <span style="color:#b44">&#39;IoUBalancedNegSampler&#39;</span>, <span style="color:#b44">&#39;CombinedSampler&#39;</span>,
    <span style="color:#b44">&#39;OHEMSampler&#39;</span>, <span style="color:#b44">&#39;SamplingResult&#39;</span>, <span style="color:#b44">&#39;ScoreHLRSampler&#39;</span>
]
</code></pre></div><h3 id="training-tricks">Training tricks</h3>
<p>è®­ç»ƒæŠ€å·§éå¸¸å¤šï¼Œå¸¸è¯´çš„è°ƒå‚å¾ˆå¤§ä¸€éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯åœ¨è®¾ç½®è¿™éƒ¨åˆ†è¶…å‚ã€‚è¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒæ‚ä¹±ï¼Œå¾ˆéš¾åšåˆ°å®Œå…¨ç»Ÿä¸€ã€‚</p>
<h2 id="test">Test</h2>
<p>æµ‹è¯•æ ¸å¿ƒç»„ä»¶å’Œè®­ç»ƒéå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯ç®€å•å¾ˆå¤šï¼Œé™¤äº†å¿…å¤‡çš„ç½‘ç»œæ„å»ºéƒ¨åˆ†å¤–( backboneã€neckã€head å’Œ enhance )ï¼Œä¸éœ€è¦æ­£è´Ÿæ ·æœ¬å®šä¹‰ã€æ­£è´Ÿæ ·æœ¬é‡‡æ ·å’Œ loss è®¡ç®—ä¸‰ä¸ªæœ€éš¾çš„éƒ¨åˆ†ï¼Œä½†æ˜¯å…¶é¢å¤–éœ€è¦ä¸€ä¸ª bbox åå¤„ç†æ¨¡å—å’Œæµ‹è¯• trickã€‚</p>
<h3 id="bbox-decoder">BBox Decoder</h3>
<p>è®­ç»ƒæ—¶å€™è¿›è¡Œäº†ç¼–ç ï¼Œé‚£ä¹ˆå¯¹åº”çš„æµ‹è¯•ç¯èŠ‚éœ€è¦è¿›è¡Œè§£ç ã€‚æ ¹æ®ç¼–ç çš„ä¸åŒï¼Œè§£ç ä¹Ÿæ˜¯ä¸åŒçš„ã€‚ä¸¾ä¸ªç®€å•ä¾‹å­ï¼šå‡è®¾è®­ç»ƒæ—¶å€™å¯¹å®½é«˜æ˜¯ç›´æ¥é™¤ä»¥å›¾ç‰‡å®½é«˜è¿›è¡Œå½’ä¸€åŒ–çš„ï¼Œé‚£ä¹ˆè§£ç è¿‡ç¨‹ä¹Ÿä»…ä»…éœ€è¦ä¹˜ä»¥å›¾ç‰‡å®½é«˜å³å¯ã€‚å…¶ä»£ç å’Œ bbox encoder æ”¾åœ¨ä¸€èµ·ï¼Œåœ¨<code>mmdet/core/bbox/coder</code>ä¸­ã€‚</p>
<h3 id="bbox-postprocess">BBox PostProcess</h3>
<p>åœ¨å¾—åˆ°åŸå›¾å°ºåº¦ bbox åï¼Œç”±äºå¯èƒ½ä¼šå‡ºç°é‡å  bbox ç°è±¡ï¼Œæ•…ä¸€èˆ¬éƒ½éœ€è¦è¿›è¡Œåå¤„ç†ï¼Œæœ€å¸¸ç”¨çš„åå¤„ç†å°±æ˜¯éæå¤§å€¼æŠ‘åˆ¶ä»¥åŠå…¶å˜ç§ã€‚</p>
<p>å…¶å¯¹åº”çš„æ–‡ä»¶åœ¨<code>mmdet/core/post_processing</code>ä¸­ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">__all__ <span style="color:#666">=</span> [
    <span style="color:#b44">&#39;multiclass_nms&#39;</span>, <span style="color:#b44">&#39;merge_aug_proposals&#39;</span>, <span style="color:#b44">&#39;merge_aug_bboxes&#39;</span>,
    <span style="color:#b44">&#39;merge_aug_scores&#39;</span>, <span style="color:#b44">&#39;merge_aug_masks&#39;</span>, <span style="color:#b44">&#39;fast_nms&#39;</span>
]
</code></pre></div><h3 id="testing-tricks">Testing tricks</h3>
<p>ä¸ºäº†æé«˜æ£€æµ‹æ€§èƒ½ï¼Œæµ‹è¯•é˜¶æ®µä¹Ÿä¼šé‡‡ç”¨ trickã€‚è¿™ä¸ªé˜¶æ®µçš„ tricks ä¹Ÿéå¸¸å¤šï¼Œéš¾ä»¥å®Œå…¨ç»Ÿä¸€ï¼Œæœ€å…¸å‹çš„æ˜¯å¤šå°ºåº¦æµ‹è¯•ä»¥åŠå„ç§æ¨¡å‹é›†æˆæ‰‹æ®µï¼Œå…¸å‹é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a2f">dict</span>(
    <span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;MultiScaleFlipAug&#39;</span>,
    img_scale<span style="color:#666">=</span>(<span style="color:#666">1333</span>, <span style="color:#666">800</span>),
    flip<span style="color:#666">=</span>True,
    transforms<span style="color:#666">=</span>[
        <span style="color:#a2f">dict</span>(<span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;Resize&#39;</span>, keep_ratio<span style="color:#666">=</span>True),
        <span style="color:#a2f">dict</span>(<span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;RandomFlip&#39;</span>),
        <span style="color:#a2f">dict</span>(<span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;Normalize&#39;</span>, <span style="color:#666">**</span>img_norm_cfg),
        <span style="color:#a2f">dict</span>(<span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;Pad&#39;</span>, size_divisor<span style="color:#666">=</span><span style="color:#666">32</span>),
        <span style="color:#a2f">dict</span>(<span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;ImageToTensor&#39;</span>, keys<span style="color:#666">=</span>[<span style="color:#b44">&#39;img&#39;</span>]),
        <span style="color:#a2f">dict</span>(<span style="color:#a2f">type</span><span style="color:#666">=</span><span style="color:#b44">&#39;Collect&#39;</span>, keys<span style="color:#666">=</span>[<span style="color:#b44">&#39;img&#39;</span>]),
    ])
</code></pre></div><h3 id="example">Example</h3>
<p>åœ¨åˆ†æå®Œæ¯ä¸ªè®­ç»ƒæµç¨‹çš„å„ä¸ªæ ¸å¿ƒç»„ä»¶åï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£æ•´ä¸ªç®—æ³•æ„å»ºï¼Œä¸‹é¢åˆ†æ MMDetection æ˜¯å¦‚ä½•ç»„åˆå„ä¸ªç»„ä»¶è¿›è¡Œè®­ç»ƒçš„ï¼Œè¿™é‡Œä»¥ one-stage æ£€æµ‹å™¨ä¸ºä¾‹ï¼Œtwo-stage ä¹Ÿæ¯”è¾ƒç±»ä¼¼ã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">SingleStageDetector</span>(<span style="color:#666">---</span>):

   <span style="color:#a2f;font-weight:bold">def</span> __init__(<span style="color:#666">...</span>):
        <span style="color:#080;font-style:italic"># æ„å»ºéª¨æ¶ã€neckå’Œhead</span>
        self<span style="color:#666">.</span>backbone <span style="color:#666">=</span> build_backbone(backbone)
        <span style="color:#a2f;font-weight:bold">if</span> neck <span style="color:#a2f;font-weight:bold">is</span> <span style="color:#a2f;font-weight:bold">not</span> None:
            self<span style="color:#666">.</span>neck <span style="color:#666">=</span> build_neck(neck)
        self<span style="color:#666">.</span>bbox_head <span style="color:#666">=</span> build_head(bbox_head)

  <span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">forward_train</span>(<span style="color:#666">---</span>): 
        <span style="color:#080;font-style:italic"># å…ˆè¿è¡Œbackbone+neckè¿›è¡Œç‰¹å¾æå–</span>
        x <span style="color:#666">=</span> self<span style="color:#666">.</span>extract_feat(img)
        <span style="color:#080;font-style:italic"># å¯¹headè¿›è¡Œforward trainï¼Œè¾“å‡ºloss</span>
        losses <span style="color:#666">=</span> self<span style="color:#666">.</span>bbox_head<span style="color:#666">.</span>forward_train(x, img_metas, gt_bboxes,
                                              gt_labels, gt_bboxes_ignore)
        <span style="color:#a2f;font-weight:bold">return</span> losses

  <span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">simple_test</span>(<span style="color:#666">---</span>):
        <span style="color:#080;font-style:italic"># å…ˆè¿è¡Œbackbone+neckè¿›è¡Œç‰¹å¾æå–</span>
        x <span style="color:#666">=</span> self<span style="color:#666">.</span>extract_feat(img)
        <span style="color:#080;font-style:italic"># headè¾“å‡ºé¢„æµ‹ç‰¹å¾å›¾</span>
        outs <span style="color:#666">=</span> self<span style="color:#666">.</span>bbox_head(x)
        <span style="color:#080;font-style:italic"># bboxè§£ç å’Œè¿˜åŸ</span>
        bbox_list <span style="color:#666">=</span> self<span style="color:#666">.</span>bbox_head<span style="color:#666">.</span>get_bboxes(
            <span style="color:#666">*</span>outs, img_metas, rescale<span style="color:#666">=</span>rescale)
        <span style="color:#080;font-style:italic"># é‡ç»„ç»“æœè¿”å›</span>
        bbox_results <span style="color:#666">=</span> [
            bbox2result(det_bboxes, det_labels, self<span style="color:#666">.</span>bbox_head<span style="color:#666">.</span>num_classes)
            <span style="color:#a2f;font-weight:bold">for</span> det_bboxes, det_labels <span style="color:#a2f;font-weight:bold">in</span> bbox_list
        ]
        <span style="color:#a2f;font-weight:bold">return</span> bbox_results
</code></pre></div><p>ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªæ£€æµ‹å™¨ç®—æ³•è®­ç»ƒå’Œæµ‹è¯•æœ€ç®€é€»è¾‘ï¼Œå¯ä»¥å‘ç°è®­ç»ƒéƒ¨åˆ†æœ€æ ¸å¿ƒçš„å°±æ˜¯<code>bbox_head.forward_train</code>ï¼Œæµ‹è¯•éƒ¨åˆ†æœ€æ ¸å¿ƒçš„æ˜¯<code>bbox_head.get_bboxes</code>ï¼Œä¸‹é¢å•ç‹¬ç®€è¦åˆ†æã€‚</p>
<h4 id="bbox_headforward_train">bbox_head.forward_train</h4>
<p><code>forward_train</code> æ˜¯é€šç”¨å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">forward_train</span>(<span style="color:#666">...</span>):
    <span style="color:#080;font-style:italic"># è°ƒç”¨æ¯ä¸ªheadè‡ªèº«çš„forwardæ–¹æ³•</span>
    outs <span style="color:#666">=</span> self(x)
    <span style="color:#a2f;font-weight:bold">if</span> gt_labels <span style="color:#a2f;font-weight:bold">is</span> None:
        loss_inputs <span style="color:#666">=</span> outs <span style="color:#666">+</span> (gt_bboxes, img_metas)
    <span style="color:#a2f;font-weight:bold">else</span>:
        loss_inputs <span style="color:#666">=</span> outs <span style="color:#666">+</span> (gt_bboxes, gt_labels, img_metas)
    <span style="color:#080;font-style:italic"># è®¡ç®—æ¯ä¸ªheadè‡ªèº«çš„lossæ–¹æ³•</span>
    losses <span style="color:#666">=</span> self<span style="color:#666">.</span>loss(<span style="color:#666">*</span>loss_inputs, gt_bboxes_ignore<span style="color:#666">=</span>gt_bboxes_ignore)
    <span style="color:#080;font-style:italic"># è¿”å›</span>
    <span style="color:#a2f;font-weight:bold">return</span> losses
</code></pre></div><p>å¯¹äºä¸åŒçš„ headï¼Œè™½ç„¶ forward å†…å®¹ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥æŠ½è±¡ä¸ºï¼š <code>outs = self(x)</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">forward</span>(self, feats):
   <span style="color:#080;font-style:italic"># å¤šå°ºåº¦ç‰¹å¾å›¾ï¼Œä¸€ä¸ªä¸€ä¸ªè¿­ä»£è¿›è¡Œforward_single</span>
   <span style="color:#a2f;font-weight:bold">return</span> multi_apply(self<span style="color:#666">.</span>forward_single, feats)

<span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">forward_single</span>(self, x):
   <span style="color:#080;font-style:italic"># è¿è¡Œå„ä¸ªheadç‹¬ç‰¹çš„head forwardæ–¹æ³•ï¼Œå¾—åˆ°é¢„æµ‹å›¾</span>
   <span style="color:#666">....</span>
   <span style="color:#a2f;font-weight:bold">return</span> cls_score, bbox_pred<span style="color:#666">...</span>
</code></pre></div><p>è€Œå¯¹äºä¸åŒçš„ headï¼Œå…¶ loss è®¡ç®—éƒ¨åˆ†ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥ç®€å•æŠ½è±¡ä¸ºï¼š<code>losses = self.loss(...)</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">loss</span>(<span style="color:#666">...</span>):
    <span style="color:#080;font-style:italic"># 1 ç”Ÿæˆanchor-baseéœ€è¦çš„anchoræˆ–è€…anchor-freeéœ€è¦çš„points</span>
    <span style="color:#080;font-style:italic"># 2 åˆ©ç”¨gt bboxå¯¹ç‰¹å¾å›¾æˆ–è€…anchorè®¡ç®—å…¶æ­£è´Ÿå’Œå¿½ç•¥æ ·æœ¬å±æ€§</span>
    <span style="color:#080;font-style:italic"># 3 è¿›è¡Œæ­£è´Ÿæ ·æœ¬é‡‡æ ·</span>
    <span style="color:#080;font-style:italic"># 4 å¯¹gt bboxè¿›è¡Œbboxç¼–ç </span>
    <span style="color:#080;font-style:italic"># 5 lossè®¡ç®—ï¼Œå¹¶è¿”å›</span>
    <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">dict</span>(loss_cls<span style="color:#666">=</span>losses_cls, loss_bbox<span style="color:#666">=</span>losses_bbox,<span style="color:#666">...</span>)
</code></pre></div><h4 id="bbox_headget_bboxes">bbox_head.get_bboxes</h4>
<p><code>get_bboxes</code> å‡½æ•°æ›´åŠ ç®€å•</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">get_bboxes</span>(<span style="color:#666">...</span>):
   <span style="color:#080;font-style:italic"># 1 ç”Ÿæˆanchor-baseéœ€è¦çš„anchoræˆ–è€…anchor-freeéœ€è¦çš„points</span>
   <span style="color:#080;font-style:italic"># 2 éå†æ¯ä¸ªè¾“å‡ºå±‚ï¼Œéå†batchå†…éƒ¨çš„æ¯å¼ å›¾ç‰‡ï¼Œå¯¹æ¯å¼ å›¾ç‰‡å…ˆæå–æŒ‡å®šä¸ªæ•°çš„é¢„æµ‹ç»“æœï¼Œç¼“è§£åé¢åå¤„ç†å‹åŠ›ï¼›å¯¹ä¿ç•™çš„ä½ç½®è¿›è¡Œbboxè§£ç å’Œè¿˜åŸåˆ°åŸå›¾å°ºåº¦</span>
   <span style="color:#080;font-style:italic"># 3 ç»Ÿä¸€nmsåå¤„ç†</span>
   <span style="color:#a2f;font-weight:bold">return</span> det_bboxes, det_labels<span style="color:#666">...</span>
</code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>æœ¬æ–‡é‡ç‚¹åˆ†æäº†ä¸€ä¸ªç›®æ ‡æ£€æµ‹å™¨æ˜¯å¦‚ä½•é€šè¿‡å¤šä¸ªæ ¸å¿ƒç»„ä»¶å †å è€Œæˆï¼Œä¸æ¶‰åŠå…·ä½“ä»£ç ï¼Œå…¶ä¸­æœ€åº”è¯¥äº†è§£çš„æ˜¯ï¼š<strong>ä»»ä½•ä¸€ä¸ªç›®æ ‡æ£€æµ‹ç®—æ³•éƒ½å¯ä»¥åˆ†æˆ n ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œç»„ä»¶å’Œç»„ä»¶ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œæ–¹ä¾¿å¤ç”¨å’Œè®¾è®¡</strong>ã€‚å½“é¢å¯¹ä¸€ä¸ªæ–°ç®—æ³•æ—¶å€™æˆ‘ä»¬å¯ä»¥å…ˆåˆ†æå…¶ä¸»è¦æ˜¯æ”¹è¿›äº†å“ªå‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œç„¶åå°±å¯ä»¥é«˜æ•ˆçš„æŒæ¡è¯¥ç®—æ³•ã€‚</p>
<h1 id="reference">Reference</h1>
<ul>
<li>åŸæ–‡ï¼š<a href="https://zhuanlan.zhihu.com/p/337375549">è½»æ¾æŒæ¡ MMDetection æ•´ä½“æ„å»ºæµç¨‹</a></li>
</ul>

    
  </article>
  <div class="paginator">
    
    <a class="link" href="https://preminstrel.github.io/blog/post/2022/01/14/faster-r-cnn/">â† prev</a>
    
    
    <a class="link" href="https://preminstrel.github.io/blog/post/2022/01/16/mmdetection-framework/">next â†’</a>
    
  </div>
  <div class="comment">
    
    
    
    
    
    
  </div>
  
</main>

    <footer id="footer">
  <div>
    <span>Â© 2021</span> - <span>2022</span>
  </div>

  <div>
    <span>Powered by </span>
    <a class="link" href="https://gohugo.io/">Hugo</a>
    <span> ğŸ¦ Theme </span>
    <a class="link" href="https://github.com/queensferryme/hugo-theme-texify">TeXify</a>
  </div>

  <div class="footnote">
    <span>Follow me on <a class=link href=https://github.com/preminstrel>GitHub</a>,
<a class=link href=https://twitter.com/preminstrel>Twitter</a> or
<a class=link href=/index.xml>RSS</a> |
<a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a>
</span>
  </div>
</footer>

  </div>

  
  

  
  

  
  

</body>

</html>
